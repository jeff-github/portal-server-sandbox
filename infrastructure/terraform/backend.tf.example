# Terraform State Backend Configuration
#
# This file provides examples for state backend configuration.
# Choose ONE of the following options and uncomment in your environment's main.tf:
#
# Option 1: Terraform Cloud (RECOMMENDED)
# Option 2: S3 Backend with DynamoDB locking
#
# ACTIVATION INSTRUCTIONS:
# 1. Choose your backend approach
# 2. Set up the backend infrastructure (Terraform Cloud workspace OR S3 bucket + DynamoDB table)
# 3. Uncomment the appropriate backend block in your environment's main.tf
# 4. Run: terraform init -migrate-state
#
# ⚠️  NEVER commit state files (.tfstate) to git

# ==============================================================================
# OPTION 1: Terraform Cloud (Recommended)
# ==============================================================================
#
# Benefits:
# - Built-in state locking and versioning
# - Secure variable storage
# - Team collaboration features
# - Free tier available
# - Audit trail built-in
#
# Setup:
# 1. Create account at https://app.terraform.io
# 2. Create organization: "clinical-diary"
# 3. Create workspaces:
#    - clinical-diary-dev
#    - clinical-diary-staging
#    - clinical-diary-production
# 4. Generate API token: User Settings > Tokens
# 5. Configure CLI: terraform login
# 6. Uncomment in main.tf:
#
# terraform {
#   cloud {
#     organization = "clinical-diary"
#     workspaces {
#       name = "clinical-diary-{environment}"  # Replace {environment}
#     }
#   }
# }

# ==============================================================================
# OPTION 2: S3 Backend with DynamoDB Locking
# ==============================================================================
#
# Benefits:
# - Self-hosted control
# - Lower cost for small teams
# - Integrates with existing AWS setup
#
# Setup:
# 1. Create S3 bucket:
#    aws s3api create-bucket \
#      --bucket clinical-diary-terraform-state \
#      --region us-west-1 \
#      --create-bucket-configuration LocationConstraint=us-west-1
#
# 2. Enable versioning:
#    aws s3api put-bucket-versioning \
#      --bucket clinical-diary-terraform-state \
#      --versioning-configuration Status=Enabled
#
# 3. Enable encryption:
#    aws s3api put-bucket-encryption \
#      --bucket clinical-diary-terraform-state \
#      --server-side-encryption-configuration '{
#        "Rules": [{
#          "ApplyServerSideEncryptionByDefault": {
#            "SSEAlgorithm": "AES256"
#          }
#        }]
#      }'
#
# 4. Create DynamoDB table for locking:
#    aws dynamodb create-table \
#      --table-name terraform-state-lock \
#      --attribute-definitions AttributeName=LockID,AttributeType=S \
#      --key-schema AttributeName=LockID,KeyType=HASH \
#      --billing-mode PAY_PER_REQUEST \
#      --region us-west-1
#
# 5. Uncomment in main.tf:
#
# terraform {
#   backend "s3" {
#     bucket         = "clinical-diary-terraform-state"
#     key            = "environments/{environment}/terraform.tfstate"  # Replace {environment}
#     region         = "us-west-1"
#     encrypt        = true
#     dynamodb_table = "terraform-state-lock"
#   }
# }

# ==============================================================================
# MIGRATION FROM LOCAL STATE
# ==============================================================================
#
# If you've been using local state and want to migrate:
#
# 1. Ensure current state is clean:
#    terraform plan  # Should show no changes
#
# 2. Uncomment backend configuration in main.tf
#
# 3. Initialize and migrate:
#    terraform init -migrate-state
#
# 4. Verify migration:
#    terraform state list
#
# 5. Delete local state files:
#    rm terraform.tfstate*
#
# 6. Test:
#    terraform plan

# ==============================================================================
# SECURITY NOTES
# ==============================================================================
#
# - State files contain sensitive data (passwords, keys, etc.)
# - Always encrypt state at rest
# - Use access controls (IAM policies or Terraform Cloud teams)
# - Enable audit logging
# - Regular state backups (automatic with both options)
# - Never commit state files to git
# - Add to .gitignore:
#   *.tfstate
#   *.tfstate.*
#   .terraform/
