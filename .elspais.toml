# Tip: Create .elspais.local.toml alongside this file for developer-local
# overrides (e.g. associate paths). It is deep-merged and gitignored.

project = { name = "hht-diary", type = "core" }
validation = { strict_hierarchy = true, hash_algorithm = "sha256", hash_length = 8 }

[directories]
spec = ["spec", "spec/regulations/fda"]
docs = "docs"
database = "database"
code = ["apps", "packages", "server", "tools"]
ignore = [
    "node_modules",
    ".git",
    "build",
    "dist",
    ".dart_tool",
    "__pycache__",
    ".venv",
    "venv",
    "untracked-notes",
]

[patterns]
id_template = "{prefix}-{type}{id}"
prefix = "REQ"
id_format = { style = "numeric", digits = 5, leading_zeros = true }

[patterns.assertions]
label_style = "uppercase"
max_count = 26

[patterns.types]
prd = { id = "p", name = "Product Requirement", level = 1 }
ops = { id = "o", name = "Operations Requirement", level = 2 }
dev = { id = "d", name = "Development Requirement", level = 3 }

[patterns.associated]
enabled = true
position = "after_prefix"
format = "uppercase"
length = 3
separator = "-"

[sponsors]
config_file = ".github/config/sponsors.yml"
manifest_env = "SPONSOR_MANIFEST"
repo_pattern = "hht_diary_{sponsor-name}"

[spec]
index_file = "INDEX.md"
readme_file = "README.md"
format_guide = "requirements-format.md"
skip_files = ["README.md", "requirements-format.md", "INDEX.md"]
skip_dirs = ["roadmap", "regulations/fda/reference"]
"prd-*.md" = "prd"
"ops-*.md" = "ops"
"dev-*.md" = "dev"
"**/prd-*.md" = "prd"
"**/ops-*.md" = "ops"
"**/dev-*.md" = "dev"

[rules.hierarchy]
dev = ["dev", "ops", "prd"]
ops = ["ops", "prd"]
prd = ["prd"]
allow_circular = false
allow_orphans = true

[rules.format]
require_hash = true
require_rationale = false
require_status = true
allowed_statuses = ["Active", "Draft", "Deprecated", "Superseded"]
require_assertions = false
acceptance_criteria = "error"
require_shall = false
labels_sequential = false
labels_unique = false

[traceability]
output_formats = ["markdown", "html"]
output_dir = "build-reports/combined/traceability"
include_associated = true
scan_patterns = [
    "database/**/*.sql",
    "apps/**/*.dart",
    "packages/**/*.dart",
    "tools/**/*.py",
    ".github/workflows/**/*.yml",
]
associated_patterns = ["sponsor/{name}/**/*.dart", "sponsor/{name}/**/*.sql", "sponsor/{name}/**/*.py"]

[testing]
enabled = true
test_dirs = ["apps/**/test", "apps/**/integration_test", "packages/**/test", "packages/**/integration_test", "tools/**/tests", "database/tests"]
patterns = ["*_test.dart", "test_*.dart", "test_*.py", "*_test.sql", "test_*.sql"]
result_files = ["build-reports/**/TEST-*.xml", "build-reports/pytest-results.json"]
default_mode = "core"
